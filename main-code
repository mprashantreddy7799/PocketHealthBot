{
  "version": 3,
  "steps": [
    {
      "id": "4676f5c0f77c-ec78307880be5a9a-d793",
      "type": "prompt",
      "dataType": "object",
      "designer": {
        "xLocation": 392,
        "yLocation": 20,
        "next": "a291d882f045-dc43d4d11d6f3ded-8d8d"
      },
      "text": "Developer notice:",
      "variable": "Consent",
      "stringId": "stringId_0cc175b9c0f1b6a8",
      "layout": "vertical",
      "attachment": [
        {
          "type": "AdaptiveCard",
          "cardCode": "{\r\n    \"type\": \"AdaptiveCard\",\r\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\r\n    \"version\": \"1.0\",\r\n    \"body\": [\r\n        {\r\n            \"type\": \"TextBlock\",\r\n            \"size\": \"Medium\",\r\n            \"weight\": \"Bolder\",\r\n            \"text\": \"Scheduling medical appointments \"\r\n        },\r\n        {\r\n            \"type\": \"TextBlock\",\r\n            \"text\": \"With Healthcare Bot appointment scheduling you can allow users to schedule an appointment with a healthcare provider without leaving the conversation. \\n\\n\",\r\n            \"wrap\": true\r\n        },\r\n        {\r\n            \"type\": \"TextBlock\",\r\n            \"text\": \"This template contains the structure for creating an appointment scheduling bot using FHIR. Note that the business rules for displaying availability should be handled separately. \\n\\n\",\r\n            \"wrap\": true\r\n        },\r\n        \r\n        {\r\n            \"type\": \"TextBlock\",\r\n            \"text\": \"Important Note: \",\r\n            \"weight\": \"Bolder\"\r\n        },\r\n        {\r\n            \"type\": \"TextBlock\",\r\n            \"text\": \"This scenario utilizes an public FHIR server and should be used for testing purposes only.\",\r\n            \"wrap\": true\r\n        }\r\n    ],\r\n    \"actions\": [\r\n    {\r\n      \"type\": \"Action.Submit\",\r\n      \"title\": \"Continue\"\r\n    }\r\n  ]\r\n    \r\n}"
        }
      ],
      "label": "Notice"
    },
    {
      "id": "a291d882f045-dc43d4d11d6f3ded-8d8d",
      "type": "prompt",
      "dataType": "['Yes', 'No']",
      "designer": {
        "xLocation": 391,
        "yLocation": 80,
        "listStyle": 3,
        "next": "9ec4f8beae25-c4b4a989620942c7-e56a"
      },
      "text": "Welcome, May I help you find a health provider and schedule an appointment for you?  ",
      "variable": "userConsent",
      "choiceType": "choice",
      "stringId": "stringId_518d5658a0ba0441",
      "label": "Welcome"
    },
    {
      "id": "20737162a687-2f88f90ae4ff837e-e760",
      "type": "action",
      "label": "serviceTypes",
      "designer": {
        "xLocation": 394,
        "yLocation": 220,
        "next": "029e12761327-6763f043cf49e6cf-8fba"
      },
      "onInit": "scenario.availableServiceTypes = {\r\n    \"Breast Screen\": {\r\n        \"code\": \"272\"\r\n    },\r\n    \"Computed Tomography Scan (CT)\": {\r\n        \"code\": \"209\"\r\n    },\r\n    \"Fluoroscopy\": {\r\n        \"code\": \"209\"\r\n    },\r\n    \"Nuclear Medicine\": {\r\n        \"code\": \"212\"\r\n    },\r\n    \"Diagnostic Ultrasound\": {\r\n        \"code\": \"210\"\r\n    },\r\n    \"X-Ray\": {\r\n        \"code\": \"209\"\r\n    }\r\n};",
      "visible": true,
      "async": false
    },
    {
      "id": "029e12761327-6763f043cf49e6cf-8fba",
      "type": "prompt",
      "dataType": "scenario.availableServiceTypes",
      "designer": {
        "xLocation": 390,
        "yLocation": 300,
        "listStyle": 3,
        "next": "a4cd62f4eb68-a23ce3da2e73a626-eb44"
      },
      "text": "Please select a service from the below list:",
      "variable": "selectedServiceType",
      "stringId": "stringId_c1bc631fae12f7df",
      "choiceType": "choice",
      "label": "Select type"
    },
    {
      "id": "98f942e5014a-f5622096aa0f267b-d372",
      "type": "datasource",
      "designer": {
        "xLocation": 389,
        "yLocation": 820,
        "next": "dd09d52444f0-6127784ad52de326-2f2d",
        "errorStepId": "2f9ad59f5d8d-db37c9a2f31b7797-e4b8"
      },
      "dataConnection": "FHIR server for appointment scheduling",
      "urlPath": "/Slot",
      "urlParams": "`schedule=${scenario.selectedSchedule.id}`",
      "method": "get",
      "headers": "",
      "opJson": true,
      "opResolveWithFullResponse": false,
      "response": "availableSlotsReponse",
      "label": "Get slots",
      "fhirAction": "Read",
      "fhirResource": "Slot",
      "payload": "/* fill the missing fields */\nFHIR({\n  \"resourceType\": \"Slot\"\n});"
    },
    {
      "id": "a4cd62f4eb68-a23ce3da2e73a626-eb44",
      "type": "action",
      "label": "Get code",
      "designer": {
        "xLocation": 394,
        "yLocation": 370,
        "next": "c74bda4834c5-f57e6d647ff3f52b-5138"
      },
      "onInit": "scenario.selectedServiceTypeCode = scenario.availableServiceTypes[scenario.selectedServiceType.entity].code;",
      "visible": true,
      "async": false
    },
    {
      "id": "7ac438cb489c-4e926184a815dc4c-bf64",
      "type": "statement",
      "designer": {
        "xLocation": 274,
        "yLocation": 220
      },
      "text": "If you have any further questions, please don’t hesitate to contact me.",
      "stringId": "stringId_7dd2bb2c580ab0dc"
    },
    {
      "id": "2f9ad59f5d8d-db37c9a2f31b7797-e4b8",
      "type": "statement",
      "designer": {
        "xLocation": 252,
        "yLocation": 740
      },
      "text": "I was not able to find open slots, please try again later.",
      "stringId": "stringId_761a6f4fd3c3d1f5"
    },
    {
      "id": "c74bda4834c5-f57e6d647ff3f52b-5138",
      "type": "statement",
      "designer": {
        "xLocation": 389,
        "yLocation": 460,
        "next": "6ac2ba046181-2526d0a87345aea7-13d5"
      },
      "text": "Got it! I will be happy to assist you in with setting it up.",
      "stringId": "stringId_4dd88f65fad5af0a",
      "label": ""
    },
    {
      "id": "a2da92d8f49f-1721deedc2a067c0-c43d",
      "type": "datasource",
      "designer": {
        "xLocation": 967,
        "yLocation": 620,
        "next": "289a294095d2-aa6b404d235ae4fa-34df",
        "reverse": true,
        "errorStepId": "f3f8ce7915df-b577dc5f64070dd6-b24c"
      },
      "dataConnection": "%Tenant's FHIR server data connection%",
      "urlPath": "/Patient",
      "urlParams": "`given=${scenario.searchPatientInfo.firstName}&family=${scenario.searchPatientInfo.lastName}&gender=${scenario.searchPatientInfo.gender}&birthdate=${scenario.searchPatientInfo.birthDate}`",
      "method": "get",
      "headers": "",
      "opJson": true,
      "opResolveWithFullResponse": false,
      "response": "searchPatientResponse",
      "label": "Search existing Patient",
      "authenticationProvider": "%Tenant's FHIR server auth-provider%",
      "fhirAction": "Read",
      "fhirResource": "Patient",
      "payload": "/* fill the missing fields */\nFHIR({\n  \"resourceType\": \"Patient\"\n});"
    },
    {
      "id": "6ac2ba046181-2526d0a87345aea7-13d5",
      "type": "datasource",
      "designer": {
        "xLocation": 390,
        "yLocation": 540,
        "next": "2a1eadce992a-abaa0e7818423d4e-e03f",
        "errorStepId": "2f9ad59f5d8d-db37c9a2f31b7797-e4b8"
      },
      "dataConnection": "FHIR server for appointment scheduling",
      "urlPath": "/Schedule",
      "urlParams": "`service-type=${scenario.selectedServiceTypeCode}`",
      "method": "get",
      "headers": "",
      "opJson": true,
      "opResolveWithFullResponse": false,
      "response": "availableSchedulesResponse",
      "label": "Get schedules",
      "fhirAction": "Read",
      "fhirResource": "Schedule",
      "payload": "/* fill the missing fields */\nFHIR({\n  \"resourceType\": \"Schedule\"\n});"
    },
    {
      "id": "ea07d46be4a3-795e5641bde518d2-2058",
      "type": "prompt",
      "dataType": "scenario.availableSlots",
      "designer": {
        "xLocation": 390,
        "yLocation": 1090,
        "listStyle": 3,
        "next": "5dc09ed97398-ffed6e2f5572de0a-29bd"
      },
      "text": "Please select a date and time for your appointment: ",
      "variable": "selectedSlotStartText",
      "stringId": "stringId_ff87f72cb613eda7",
      "choiceType": "choice",
      "label": "Time"
    },
    {
      "id": "dd09d52444f0-6127784ad52de326-2f2d",
      "type": "action",
      "label": "Available slots",
      "designer": {
        "xLocation": 393,
        "yLocation": 900,
        "next": "ac43e93ecc06-027530b882db2982-c6be"
      },
      "onInit": "scenario.availableSlots = {};\r\nscenario.availableSlotsReponse.entry.map(entry => entry.resource).forEach(resource => {\r\n    const date = new Date(resource.start);\r\n    const dateText = moment(date).format(\"dddd, MMMM Do YYYY, h:mm A\");\r\n    scenario.availableSlots[dateText] = {\r\n        slot: resource\r\n    };\r\n});"
    },
    {
      "id": "2a1eadce992a-abaa0e7818423d4e-e03f",
      "type": "action",
      "label": "Selected schedule",
      "designer": {
        "xLocation": 394,
        "yLocation": 629,
        "next": "98bf84566402-e951c9d55729919f-fd24"
      },
      "onInit": "scenario.availableSchedules = [];\r\nif (scenario.availableSchedulesResponse && scenario.availableSchedulesResponse.entry) {\r\n    scenario.availableSchedules = scenario.availableSchedulesResponse.entry.map(entry => entry.resource);\r\n}\r\nif (scenario.availableSchedules.length > 0) {\r\n    // assuming there is one schedule for each service type we set the first one on selectedSchedule\r\n    scenario.selectedSchedule = scenario.availableSchedules[0];\r\n}"
    },
    {
      "id": "a33a29b90878-d2ba8903a3e41439-4a83",
      "type": "datasource",
      "designer": {
        "xLocation": 730,
        "yLocation": 611,
        "next": "f9c3527cfed7-e867c5ed69e87451-afa4",
        "errorStepId": "f3f8ce7915df-b577dc5f64070dd6-b24c"
      },
      "dataConnection": "%Tenant's FHIR server data connection%",
      "urlPath": "/Patient",
      "urlParams": "'_format=application/json'",
      "method": "post",
      "headers": "",
      "payload": "{\n    \"resourceType\": \"Patient\",\n    \"name\": {\n        \"given\": scenario.createPatientInfo.firstName,\n\t\t\"family\": scenario.createPatientInfo.lastName,\n\t\t\"text\": scenario.createPatientInfo.firstName + \" \" + scenario.createPatientInfo.lastName\n    },\n    \"birthDate\": scenario.createPatientInfo.birthDate,\n    \"gender\": scenario.createPatientInfo.gender,\n    \"telecom\": [\n    \t{\n    \t\t\"system\": \"email\",\n    \t\t\"value\": scenario.createPatientInfo.email\n    \t},\n    \t{\n    \t\t\"system\": \"phone\",\n    \t\t\"value\": scenario.createPatientInfo.mobilePhone,\n    \t\t\"use\": \"mobile\"\n    \t},\n    \t{\n\t\t\t\"system\": \"phone\",\n    \t\t\"value\": scenario.createPatientInfo.homePhone,\n    \t\t\"use\": \"home\"\n    \t}\n    ]\n}",
      "opJson": true,
      "opResolveWithFullResponse": false,
      "response": "createPatientResponse",
      "label": "Create Patient",
      "authenticationProvider": "%Tenant's FHIR server auth-provider%",
      "fhirAction": "Create",
      "fhirResource": "Patient"
    },
    {
      "id": "289a294095d2-aa6b404d235ae4fa-34df",
      "type": "action",
      "label": "Get selectedPatient from searchPatientResponse",
      "designer": {
        "xLocation": 967,
        "yLocation": 680,
        "next": "f76048d44afb-38f651e3ff0faf40-b436"
      },
      "onInit": "scenario.availablePatients = [];\r\nif(scenario.searchPatientResponse && scenario.searchPatientResponse.entry){\r\n    scenario.availablePatients = scenario.searchPatientResponse.entry.map(entry => entry.resource);\r\n}\r\nif(scenario.availablePatients.length > 0) {\r\n    // assuming there is one patient for given search criteria\r\n    scenario.selectedPatient = scenario.availablePatients[0];\r\n}"
    },
    {
      "id": "f9c3527cfed7-e867c5ed69e87451-afa4",
      "type": "action",
      "label": "Get selectedPatient from createPatientResponse",
      "designer": {
        "xLocation": 707,
        "yLocation": 680,
        "next": "f76048d44afb-38f651e3ff0faf40-b436"
      },
      "onInit": "scenario.selectedPatient = scenario.createPatientResponse;"
    },
    {
      "id": "f76048d44afb-38f651e3ff0faf40-b436",
      "type": "branch",
      "condition": "scenario.selectedPatient != null && scenario.selectedPatient.id",
      "designer": {
        "xLocation": 847,
        "yLocation": 740,
        "next": "078514832929-825a7f2a7f48ffb8-85e7"
      },
      "label": "verify selectedPatient and id exist",
      "targetStepId": "6d8d5624fc68-14dbc6ab4e4f5480-66ba"
    },
    {
      "id": "6d8d5624fc68-14dbc6ab4e4f5480-66ba",
      "type": "datasource",
      "designer": {
        "xLocation": 967,
        "yLocation": 760,
        "errorStepId": "f3f8ce7915df-b577dc5f64070dd6-b24c"
      },
      "dataConnection": "%Tenant's FHIR server data connection%",
      "urlPath": "'/Appointment'",
      "urlParams": "'_format=application/json'",
      "method": "post",
      "headers": "",
      "payload": "{\n    \"resourceType\": \"Appointment\",\n    \"status\": \"booked\",\n    \"serviceType\": [{\n\t\t\"coding\": [{\n\t\t\t\"code\": scenario.selectedServiceTypeCode\n\t\t}]\n\t}],\n\t\"start\": scenario.selectedSlot.start,\n\t\"end\": scenario.selectedSlot.end,\n\t\"slot\": {\n\t\t\"reference\": \"Slot/\" + scenario.selectedSlot.id,\n\t\t\"type\": \"Slot\",\n\t\t\"display\": \"Slot for appointment\"\n\t},\n\t\"comment\": scenario.appointmentComments,\n\t\"participant\": [\n\t\t{\n\t\t\t\"actor\": {\n\t\t\t\t\"reference\": scenario.selectedSchedule.actor[0].reference,\n\t\t\t\t\"type\": \"HealthcareService\",\n\t\t\t\t\"display\": \"HealthcareService of the appointment\"\n\t\t\t},\n\t\t\t\"required\": \"required\",\n\t\t\t\"status\": \"accepted\"\n\t\t},\n\t\t{\n\t\t\t\"actor\": {\n\t\t\t\t\"reference\": \"Patient/\" + scenario.selectedPatient.id,\n\t\t\t\t\"type\": \"Patient\",\n\t\t\t\t\"display\": \"Patient of the appointment\"\n\t\t\t},\n\t\t\t\"required\": \"required\",\n\t\t\t\"status\": \"accepted\"\n\t\t}\n\t]\n}",
      "opJson": true,
      "opResolveWithFullResponse": false,
      "response": "createAppointmentResponse",
      "label": "Create Appointment for selectedPatient and HealthcareService",
      "authenticationProvider": "%Tenant's FHIR server auth-provider%",
      "fhirAction": "Create",
      "fhirResource": "Appointment"
    },
    {
      "id": "0b62df6d1715-fb66f7d01f91b68d-129d",
      "type": "statement",
      "designer": {
        "xLocation": 388,
        "yLocation": 1451,
        "next": "de992ea4b8ab-8eca4164be591f19-14c2"
      },
      "text": "\"Thank you, \" + scenario.createPatientInfo.firstName +\r\n\". I've scheduled an appointment for \" + scenario.selectedSlotStartText.entity + \r\n\r\n\". \\n We look forward to seeing you then.\"",
      "stringId": "stringId_710a1cd7b9ae8851",
      "label": "Summary"
    },
    {
      "id": "5dc09ed97398-ffed6e2f5572de0a-29bd",
      "type": "action",
      "label": "Selected slot",
      "designer": {
        "xLocation": 394,
        "yLocation": 1147,
        "next": "082bd2f96d15-9cef06455edd8425-f7ea"
      },
      "onInit": "scenario.selectedSlot = scenario.availableSlots[scenario.selectedSlotStartText.entity].slot"
    },
    {
      "id": "98bf84566402-e951c9d55729919f-fd24",
      "type": "branch",
      "condition": "scenario.selectedSchedule != null && scenario.selectedSchedule.id",
      "designer": {
        "xLocation": 400,
        "yLocation": 728,
        "next": "2f9ad59f5d8d-db37c9a2f31b7797-e4b8"
      },
      "label": "Verification",
      "targetStepId": "98f942e5014a-f5622096aa0f267b-d372"
    },
    {
      "id": "ac43e93ecc06-027530b882db2982-c6be",
      "type": "branch",
      "condition": "Object.keys(scenario.availableSlots).length > 0",
      "designer": {
        "xLocation": 400,
        "yLocation": 1000,
        "next": "2f9ad59f5d8d-db37c9a2f31b7797-e4b8"
      },
      "label": "Verification",
      "targetStepId": "ea07d46be4a3-795e5641bde518d2-2058"
    },
    {
      "id": "9ec4f8beae25-c4b4a989620942c7-e56a",
      "type": "branch",
      "condition": "scenario.userConsent.entity === 'Yes'",
      "designer": {
        "xLocation": 400,
        "yLocation": 140,
        "next": "7ac438cb489c-4e926184a815dc4c-bf64"
      },
      "targetStepId": "20737162a687-2f88f90ae4ff837e-e760",
      "label": "Consent"
    },
    {
      "id": "0eea354a555b-c4421351c96263ab-faa5",
      "type": "prompt",
      "dataType": "object",
      "designer": {
        "xLocation": 388,
        "yLocation": 1386,
        "next": "0b62df6d1715-fb66f7d01f91b68d-129d"
      },
      "variable": "createPatientInfo",
      "layout": "vertical",
      "attachment": [
        {
          "type": "AdaptiveCard",
          "cardCode": "{\r\n  \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\r\n  \"type\": \"AdaptiveCard\",\r\n  \"version\": \"1.0\",\r\n  \"body\": [\r\n    {\r\n      \"type\": \"TextBlock\",\r\n      \"text\": \"Name:\"\r\n    },\r\n    {\r\n      \"type\": \"Input.Text\",\r\n      \"placeholder\": \"First name\",\r\n      \"style\": \"text\",\r\n      \"maxLength\": 0,\r\n      \"id\": \"firstName\"\r\n    },\r\n    {\r\n      \"type\": \"Input.Text\",\r\n      \"placeholder\": \"Last Name\",\r\n      \"style\": \"text\",\r\n      \"maxLength\": 0,\r\n      \"id\": \"lastName\"\r\n    },\r\n    {\r\n        \"type\": \"TextBlock\",\r\n        \"text\": \"Gender:\"\r\n    },\r\n    {\r\n      \"type\": \"Input.ChoiceSet\",\r\n      \"isMultiSelect\": false,\r\n      \"id\": \"gender\",\r\n      \"style\": \"expanded\",\r\n      \"value\": \"female\",\r\n      \"choices\": [\r\n        {\r\n          \"title\": \"Female\",\r\n          \"value\": \"female\"\r\n        },\r\n        {\r\n          \"title\": \"Male\",\r\n          \"value\": \"male\"\r\n        },\r\n        {\r\n          \"title\": \"Other\",\r\n          \"value\": \"other\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"type\": \"TextBlock\",\r\n      \"text\": \"Date of birth:\"\r\n    },\r\n    {\r\n      \"type\": \"Input.Date\",\r\n      \"placeholder\": \"Date of birth\",\r\n      \"id\": \"birthDate\"\r\n    },\r\n    {\r\n        \"type\": \"TextBlock\",\r\n        \"text\": \"Mobile phone number:\"\r\n    },\r\n    {\r\n        \"type\": \"Input.Text\",\r\n        \"id\": \"mobilePhone\",\r\n        \"style\": \"tel\"\r\n    },\r\n    {\r\n        \"type\": \"TextBlock\",\r\n        \"text\": \"Home phone number:\"\r\n    },\r\n    {\r\n        \"type\": \"Input.Text\",\r\n        \"id\": \"homePhone\",\r\n        \"style\": \"tel\"\r\n    },\r\n    {\r\n        \"type\": \"TextBlock\",\r\n        \"text\": \"Email address:\"\r\n    },\r\n    {\r\n        \"type\": \"Input.Text\",\r\n        \"id\": \"email\",\r\n        \"style\": \"email\"\r\n    }\r\n    ],\r\n  \"actions\": [\r\n    {\r\n      \"type\": \"Action.Submit\",\r\n      \"title\": \"Schedule appointment\"\r\n    }\r\n  ]\r\n}"
        }
      ],
      "stringId": "stringId_ebf12d1f053c2ba9",
      "label": "Registration"
    },
    {
      "id": "bd1956fd4413-ea58382b854b01ad-418f",
      "type": "statement",
      "designer": {
        "xLocation": 389,
        "yLocation": 1311,
        "next": "0eea354a555b-c4421351c96263ab-faa5"
      },
      "text": "Thank you. Let me take your information before scheduling the appointment.",
      "stringId": "stringId_645f17048c018277",
      "label": "Thanks"
    },
    {
      "id": "082bd2f96d15-9cef06455edd8425-f7ea",
      "type": "statement",
      "designer": {
        "xLocation": 389,
        "yLocation": 1240,
        "next": "bd1956fd4413-ea58382b854b01ad-418f"
      },
      "text": "Developer notice:",
      "stringId": "stringId_ac972b5d0738e76d",
      "layout": "vertical",
      "attachment": [
        {
          "type": "AdaptiveCard",
          "cardCode": "{\r\n    \"type\": \"AdaptiveCard\",\r\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\r\n    \"version\": \"1.0\",\r\n    \"body\": [\r\n        {\r\n            \"type\": \"TextBlock\",\r\n            \"text\": \"The following registration form is used for demo purposes only and does not submit personal information to the FHIR server.\",\r\n            \"wrap\": true\r\n        },\r\n        {\r\n            \"type\": \"TextBlock\",\r\n            \"text\": \"Once a private FHIR server is implemented, connect the registration form to the disabled data connection steps to implement patient handling and appointment scheduling.\",\r\n            \"wrap\": true\r\n        }\r\n    ]\r\n}"
        }
      ],
      "label": "Notice"
    },
    {
      "id": "078514832929-825a7f2a7f48ffb8-85e7",
      "type": "statement",
      "designer": {
        "xLocation": 707,
        "yLocation": 760
      },
      "text": "I was not able to find open slots, please try again later.",
      "stringId": "stringId_761a6f4fd3c3d1f5"
    },
    {
      "id": "b3be28eabcc7-34f1318cb23b7620-f297",
      "type": "yesnoprompt",
      "dataType": "boolean",
      "designer": {
        "xLocation": 847,
        "yLocation": 508,
        "next": "5e412d32925f-1b151af36563e473-4994"
      },
      "text": "Thank you. Let me take your information before scheduling the appointment. \r\n\r\nAre you already registered with Contoso Hospitals?  ",
      "variable": "alreadyRegistered",
      "stringId": "stringId_5bd89f1debc27fa3",
      "targetStepId": "c55b79332fe7-c93aa03848cefd79-35a1"
    },
    {
      "id": "425221c20c01-813aa9d9dde19cb3-b193",
      "type": "prompt",
      "dataType": "object",
      "designer": {
        "xLocation": 840,
        "yLocation": 420,
        "next": "b3be28eabcc7-34f1318cb23b7620-f297"
      },
      "text": "Developer notice:",
      "variable": "Consent",
      "stringId": "stringId_0cc175b9c0f1b6a8",
      "layout": "vertical",
      "attachment": [
        {
          "type": "AdaptiveCard",
          "cardCode": "{\r\n    \"type\": \"AdaptiveCard\",\r\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\r\n    \"version\": \"1.0\",\r\n    \"body\": [\r\n        {\r\n            \"type\": \"TextBlock\",\r\n            \"text\": \"This conversation flow searches for an existing patient record on the FHIR server or creates a new one and schedules the appointment.\\n\",\r\n            \"wrap\": true\r\n        },\r\n        {\r\n            \"type\": \"TextBlock\",\r\n            \"text\": \"To use this flow, replace the information on the data connection and authentication provider objects with your real FHIR server information. Then, connect this step with the main conversation flow.\",\r\n            \"wrap\": true\r\n        }\r\n    ],\r\n    \"actions\": [\r\n    {\r\n      \"type\": \"Action.Submit\",\r\n      \"title\": \"Continue\"\r\n    }\r\n  ]\r\n    \r\n}"
        }
      ],
      "label": "Notice"
    },
    {
      "id": "5e412d32925f-1b151af36563e473-4994",
      "type": "prompt",
      "dataType": "object",
      "designer": {
        "xLocation": 707,
        "yLocation": 560,
        "next": "a33a29b90878-d2ba8903a3e41439-4a83"
      },
      "variable": "createPatientInfo",
      "layout": "vertical",
      "attachment": [
        {
          "type": "AdaptiveCard",
          "cardCode": "{\r\n  \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\r\n  \"type\": \"AdaptiveCard\",\r\n  \"version\": \"1.0\",\r\n  \"body\": [\r\n    {\r\n      \"type\": \"TextBlock\",\r\n      \"text\": \"Please specify your name\"\r\n    },\r\n    {\r\n      \"type\": \"Input.Text\",\r\n      \"placeholder\": \"Name\",\r\n      \"style\": \"text\",\r\n      \"maxLength\": 0,\r\n      \"id\": \"firstName\"\r\n    },\r\n    {\r\n      \"type\": \"Input.Text\",\r\n      \"placeholder\": \"Last Name\",\r\n      \"style\": \"text\",\r\n      \"maxLength\": 0,\r\n      \"id\": \"lastName\"\r\n    },\r\n    {\r\n        \"type\": \"TextBlock\",\r\n        \"text\": \"Please select your gender\"\r\n    },\r\n    {\r\n      \"type\": \"Input.ChoiceSet\",\r\n      \"isMultiSelect\": false,\r\n      \"id\": \"gender\",\r\n      \"style\": \"expanded\",\r\n      \"value\": \"female\",\r\n      \"choices\": [\r\n        {\r\n          \"title\": \"female\",\r\n          \"value\": \"female\"\r\n        },\r\n        {\r\n          \"title\": \"male\",\r\n          \"value\": \"male\"\r\n        },\r\n        {\r\n          \"title\": \"other\",\r\n          \"value\": \"other\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"type\": \"TextBlock\",\r\n      \"text\": \"Select date of birth\"\r\n    },\r\n    {\r\n      \"type\": \"Input.Date\",\r\n      \"placeholder\": \"Date of birth\",\r\n      \"id\": \"birthDate\",\r\n      \"value\": \"1970-01-01\"\r\n    },\r\n    {\r\n        \"type\": \"TextBlock\",\r\n        \"text\": \"Mobile phone number\"\r\n    },\r\n    {\r\n        \"type\": \"Input.Text\",\r\n        \"id\": \"mobilePhone\",\r\n        \"placeholder\": \"xxx.xxx.xxxx\",\r\n        \"style\": \"tel\"\r\n    },\r\n    {\r\n        \"type\": \"TextBlock\",\r\n        \"text\": \"Home phone number\"\r\n    },\r\n    {\r\n        \"type\": \"Input.Text\",\r\n        \"id\": \"homePhone\",\r\n        \"placeholder\": \"xxx.xxx.xxxx\",\r\n        \"style\": \"tel\"\r\n    },\r\n    {\r\n        \"type\": \"TextBlock\",\r\n        \"text\": \"Your email\"\r\n    },\r\n    {\r\n        \"type\": \"Input.Text\",\r\n        \"id\": \"email\",\r\n        \"placeholder\": \"youremail@example.com\",\r\n        \"style\": \"email\"\r\n    }\r\n    ],\r\n  \"actions\": [\r\n    {\r\n      \"type\": \"Action.Submit\",\r\n      \"title\": \"Submit\"\r\n    }\r\n  ]\r\n}"
        }
      ],
      "label": "Registration form"
    },
    {
      "id": "c55b79332fe7-c93aa03848cefd79-35a1",
      "type": "prompt",
      "dataType": "object",
      "designer": {
        "xLocation": 960,
        "yLocation": 560,
        "next": "a2da92d8f49f-1721deedc2a067c0-c43d"
      },
      "variable": "searchPatientInfo",
      "layout": "vertical",
      "attachment": [
        {
          "type": "AdaptiveCard",
          "cardCode": "{\r\n  \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\r\n  \"type\": \"AdaptiveCard\",\r\n  \"version\": \"1.0\",\r\n  \"body\": [\r\n    {\r\n      \"type\": \"TextBlock\",\r\n      \"text\": \"Please specify your name\"\r\n    },\r\n    {\r\n      \"type\": \"Input.Text\",\r\n      \"placeholder\": \"Name\",\r\n      \"style\": \"text\",\r\n      \"maxLength\": 0,\r\n      \"id\": \"firstName\"\r\n    },\r\n    {\r\n      \"type\": \"Input.Text\",\r\n      \"placeholder\": \"Last Name\",\r\n      \"style\": \"text\",\r\n      \"maxLength\": 0,\r\n      \"id\": \"lastName\"\r\n    },\r\n    {\r\n        \"type\": \"TextBlock\",\r\n        \"text\": \"Select your gender\"\r\n    },\r\n    {\r\n      \"type\": \"Input.ChoiceSet\",\r\n      \"isMultiSelect\": false,\r\n      \"id\": \"gender\",\r\n      \"style\": \"expanded\",\r\n      \"value\": \"gender\",\r\n      \"choices\": [\r\n        {\r\n          \"title\": \"female\",\r\n          \"value\": \"female\"\r\n        },\r\n        {\r\n          \"title\": \"male\",\r\n          \"value\": \"male\"\r\n        },\r\n        {\r\n          \"title\": \"other\",\r\n          \"value\": \"other\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"type\": \"TextBlock\",\r\n      \"text\": \"Select date of birth\"\r\n    },\r\n    {\r\n      \"type\": \"Input.Date\",\r\n      \"placeholder\": \"Date of birth\",\r\n      \"id\": \"birthDate\",\r\n      \"value\": \"1970-01-01\"\r\n    }],\r\n  \"actions\": [\r\n    {\r\n      \"type\": \"Action.Submit\",\r\n      \"title\": \"Submit\"\r\n    }\r\n  ]\r\n}"
        }
      ],
      "label": "Existing patient details"
    },
    {
      "id": "f3f8ce7915df-b577dc5f64070dd6-b24c",
      "type": "statement",
      "designer": {
        "xLocation": 840,
        "yLocation": 654
      },
      "text": "**Developer notice:**\r\nReplace the information on the data connection and authentication provider objects with your real FHIR server informaton before using this conversation flow.",
      "stringId": "stringId_bffa905c76f79b01",
      "label": "Notice"
    },
    {
      "id": "de992ea4b8ab-8eca4164be591f19-14c2",
      "type": "prompt",
      "dataType": "[systemLocalizedStrings[\"/builtin/feedback.triage_prompt_yes\"], systemLocalizedStrings[\"/builtin/feedback.triage_prompt_no\"]]",
      "designer": {
        "xLocation": 611,
        "yLocation": 1308,
        "listStyle": 3,
        "next": "53dd66a4a80c-f0adc4ad998d3372-98df"
      },
      "text": "systemLocalizedStrings[\"/builtin/feedback.triage_prompt_question\"]",
      "variable": "show_feedback",
      "submitTitle": "Submit",
      "label": "Show feedback",
      "stringId": "stringId_1fd8f056fd6c7478",
      "choiceType": "choice"
    },
    {
      "id": "53dd66a4a80c-f0adc4ad998d3372-98df",
      "type": "branch",
      "condition": "// Evaluate whether the user agreed to provide feedback\r\n\r\nscenario.show_feedback.index == 0",
      "designer": {
        "xLocation": 620,
        "yLocation": 1369
      },
      "targetStepId": "a6f03f78ad57-f93d255a602a4477-458b"
    },
    {
      "id": "a6f03f78ad57-f93d255a602a4477-458b",
      "type": "beginScenario",
      "designer": {
        "xLocation": 620,
        "yLocation": 1451
      },
      "scenario": "/builtin/feedback"
    }
  ]
  "version": 2,
  "steps": [
    {
      "id": "933175e9d6e9-759544d3aab92243-58ba",
      "type": "yesnoprompt",
      "dataType": "boolean",
      "designer": {
        "xLocation": 120,
        "yLocation": 14,
        "next": "032401b8bdc3-2601489f61bd5be4-e6a1"
      },
      "text": "May I help you find provider?",
      "variable": "res",
      "targetStepId": "17980ff39aed-a7a0b09798ec56ed-4b1f",
      "stringId": "stringId_d06bee4197413bda"
    },
    {
      "id": "9b6374f51806-7008b402e962d220-ff93",
      "type": "datasource",
      "designer": {
        "xLocation": 380,
        "yLocation": 340,
        "errorStepId": "5acaee3b9efb-8322543072e1d8c4-dbad",
        "next": "bcca11b7999c-4f437f4bca5dee54-d4a6"
      },
      "dataConnection": "",
      "urlBase": "https://hbs-catalog-api-fd-global-prod.azurefd.net",
      "urlPath": "/providerLookup",
      "urlParams": "${user_location} + '&tk=83cf6c2a-397e-4626-9b71-1f956e551939&' + ${doctorGender} + '&specialty_uid=' + ${doctorType}",
      "method": "get",
      "headers": "",
      "opJson": true,
      "opResolveWithFullResponse": false,
      "response": "doctors",
      "error": "err",
      "label": "Provider lookup data connection call"
    },
    {
      "id": "032401b8bdc3-2601489f61bd5be4-e6a1",
      "type": "statement",
      "designer": {
        "xLocation": 32,
        "yLocation": 80
      },
      "text": "If you have any further questions, please don’t hesitate to contact me.",
      "stringId": "stringId_87561e4237b03204"
    },
    {
      "id": "17980ff39aed-a7a0b09798ec56ed-4b1f",
      "type": "prompt",
      "dataType": "[\"Doctor\",\"Dentist\"]",
      "designer": {
        "xLocation": 190,
        "yLocation": 80,
        "listStyle": 3,
        "next": "6eb38059e0f4-354d4b1c3331bfed-9eb5"
      },
      "text": "What type of provider do you look for?",
      "variable": "doctor_type",
      "layout": "vertical",
      "stringId": "stringId_61493fb14a96ce39"
    },
    {
      "id": "695d87603dbd-e563a89769ed22e4-9bd3",
      "type": "prompt",
      "dataType": [
        "Cardiology",
        "Dermatology",
        "Endocrinology",
        "Family Physicians",
        "Gastroenterology",
        "Hematology",
        "Neurology",
        "Oncology",
        "Pediatrician",
        "Psychiatrist",
        "General Surgeon",
        "Urology"
      ],
      "designer": {
        "xLocation": 380,
        "yLocation": 20,
        "listStyle": 2,
        "next": "2f5c2f4a15cb-09c7a5f23e359662-191a"
      },
      "text": "Are you interested in a specific specialty of the doctor? Please select from the list below:",
      "variable": "specialties",
      "stringId": "stringId_a55e1d1fff7cff22"
    },
    {
      "id": "2f5c2f4a15cb-09c7a5f23e359662-191a",
      "type": "prompt",
      "dataType": [
        "No",
        "Yes - Female",
        "Yes - Male"
      ],
      "designer": {
        "xLocation": 380,
        "yLocation": 74,
        "listStyle": 3,
        "next": "cfd497913114-39e037cecd51d1dd-7361"
      },
      "text": "Do you have any gender preference?",
      "variable": "gender",
      "stringId": "stringId_3a0fdeaceacf85e1"
    },
    {
      "id": "5acaee3b9efb-8322543072e1d8c4-dbad",
      "type": "statement",
      "designer": {
        "xLocation": 310,
        "yLocation": 374
      },
      "text": "JSON.stringify(${err});",
      "label": "Error handling",
      "stringId": "stringId_7f726cd178d669c8"
    },
    {
      "id": "7f375321d471-9a5124d1f8d2e22f-f54b",
      "type": "action",
      "label": "Create call parameters action",
      "designer": {
        "xLocation": 380,
        "yLocation": 270,
        "next": "9b6374f51806-7008b402e962d220-ff93"
      },
      "onInit": "switch(${gender}.entity) {\n    case \"No\":\n        ${doctorGender} = \"\";\n        break;\n    case \"Yes - Male\":\n        ${doctorGender} = \"gender=male\";\n        break;\n    default:\n        ${doctorGender} = \"gender=female\";\n}\n\nif (${doctor_type}.entity == \"Dentist\")\n    ${doctorType} = \"Dentist\";\nelse\n    ${doctorType} = ${specialties}.entity;\n\n/*\n* In order to use the user's current location as suggested below, you need to host the HealthBot Container\n* and call chatRequested().\n* Link to our github repository: https://github.com/Microsoft/HealthBotContainerSample\n */\n${mocked_location}=\"location=37.773%2C-122.413%2C100\";\nswitch (${location_option}.entity) {\n    case \"Current location\":\n        ${user_location} = @{initConversationEvent} && @{initConversationEvent}.location\n        ? \"location=\" +  @{initConversationEvent}.location.lat + \"%2C\" + @{initConversationEvent}.location.long +\"%2C100\"\n        : ${mocked_location};\n        break;\n    default:\n         ${user_location} = ${mocked_location};\n}\n"
    },
    {
      "id": "2966c1e89cd3-48981a677239cb8c-e3b5",
      "type": "statement",
      "designer": {
        "xLocation": 440,
        "yLocation": 460,
        "next": "ab38a0425e79-b8dc604135f5ef10-dd2f"
      },
      "label": "Show Cards",
      "layout": "vertical",
      "attachment": [
        {
          "type": "Carousel",
          "carouselCode": "(function(){\n    var doctors = [];\n    for (var i =0 ; i < ${doctors}.data.length; i++) {\n        doctors.push(new builder.ThumbnailCard().title(${doctors}.data[i].name).subtitle(${doctors}.data[i].specialty).\n        text(${doctors}.data[i].clinic +\"\\n\" + ${doctors}.data[i].address + \"\\n\" + ${doctors}.data[i].hours).\n        images([builder.CardImage.create(session,${doctors}.data[i].img)]).\n        buttons([\n            builder.CardAction.postBack(session,'schedule','Schedule an appointment')\n        ]));\n    }\n    return doctors;\n    })()\n"
        }
      ]
    },
    {
      "id": "cfd497913114-39e037cecd51d1dd-7361",
      "type": "prompt",
      "dataType": [
        "Current location",
        "ZIP code"
      ],
      "designer": {
        "xLocation": 380,
        "yLocation": 120,
        "listStyle": 3,
        "next": "1dcef15d1fbb-58ea976331035140-a3f0"
      },
      "text": "Got it! I will be happy to assist. Should I use your current location or would you like to specify a ZIP code?",
      "variable": "location_option",
      "stringId": "stringId_f9b71f34617f8ffa"
    },
    {
      "id": "bcca11b7999c-4f437f4bca5dee54-d4a6",
      "type": "branch",
      "condition": "${doctors}.data.length !== 0\r\n",
      "designer": {
        "xLocation": 387,
        "yLocation": 392,
        "next": "8e1bd5dc1861-395f4143d4549e6a-2635"
      },
      "targetStepId": "2966c1e89cd3-48981a677239cb8c-e3b5"
    },
    {
      "id": "8e1bd5dc1861-395f4143d4549e6a-2635",
      "type": "statement",
      "designer": {
        "xLocation": 320,
        "yLocation": 460,
        "next": "ab38a0425e79-b8dc604135f5ef10-dd2f"
      },
      "text": "No doctors were found that meet all criteria",
      "stringId": "stringId_3dbb98f559a4323a"
    },
    {
      "id": "6eb38059e0f4-354d4b1c3331bfed-9eb5",
      "type": "switch",
      "designer": {
        "xLocation": 173,
        "yLocation": 140,
        "next": "695d87603dbd-e563a89769ed22e4-9bd3"
      },
      "cases": [
        {
          "value": "Hospital",
          "targetStepId": "273d9123cd8e-a38fcd49d8611cb4-ed25"
        },
        {
          "value": "Dentist",
          "targetStepId": "2f5c2f4a15cb-09c7a5f23e359662-191a"
        }
      ],
      "condition": "${doctor_type}.entity"
    },
    {
      "id": "273d9123cd8e-a38fcd49d8611cb4-ed25",
      "type": "statement",
      "designer": {
        "xLocation": 60,
        "yLocation": 260,
        "next": "17980ff39aed-a7a0b09798ec56ed-4b1f"
      },
      "text": "This option is not implemented yet. Please try another one.",
      "stringId": "stringId_c76649e46c9d40d4"
    },
    {
      "id": "cf887de9e443-d47a25d4ea0d4902-328a",
      "type": "statement",
      "designer": {
        "xLocation": 320,
        "yLocation": 220,
        "next": "7f375321d471-9a5124d1f8d2e22f-f54b"
      },
      "text": "Developer notice!",
      "layout": "vertical",
      "attachment": [
        {
          "type": "AdaptiveCard",
          "cardCode": "{\r\n\t\"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\r\n\t\"type\": \"AdaptiveCard\",\r\n\t\"version\": \"1.0\",\r\n\t\"body\": [\r\n\t\t{\r\n\t\t\t\"type\": \"Container\",\r\n\t\t\t\"items\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"type\": \"TextBlock\",\r\n\t\t\t\t\t\"text\": \"Turn on end-user active location\",\r\n\t\t\t\t\t\"weight\": \"bolder\",\r\n\t\t\t\t\t\"size\": \"medium\"\r\n                }\r\n\t\t\t]\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"type\": \"Container\",\r\n\t\t\t\"items\": [\r\n\t\t\t\t{\r\n\t\t\t\t\t\"type\": \"TextBlock\",\r\n\t\t\t\t\t\"text\": \"This scenario currently uses a static fixed location for provider lookup, you can turn on end-user active location option only after embedding the health bot instance within your application.\",\r\n\t\t\t\t\t\"wrap\": true\r\n\t\t\t\t},\r\n                {\r\n                    \"type\": \"TextBlock\",\r\n                    \"wrap\": true,\r\n                    \"text\": \"[Embed a health bot instance in your application](https://docs.microsoft.com/en-us/healthbot/integrations/embed)\"\r\n                },\r\n                {\r\n                    \"type\": \"TextBlock\",\r\n                    \"wrap\": true,\r\n                    \"text\": \"[Sending user location while in chat](https://docs.microsoft.com/en-us/healthbot/integrations/embed)\"\r\n                }\r\n\t\t\t]\r\n\t\t}\r\n\t]\r\n}"
        }
      ],
      "label": "Developer notice",
      "stringId": "stringId_5770680de9fcb351"
    },
    {
      "id": "af530ebc0fd1-d4589ef406bd6367-2744",
      "type": "prompt",
      "dataType": "number",
      "designer": {
        "xLocation": 449,
        "yLocation": 220,
        "next": "7f375321d471-9a5124d1f8d2e22f-f54b"
      },
      "text": "Please enter a ZIP code",
      "variable": "zip",
      "stringId": "stringId_cf14ebd73bfaddbb"
    },
    {
      "id": "1dcef15d1fbb-58ea976331035140-a3f0",
      "type": "branch",
      "condition": "${location_option}.entity === \"ZIP code\"",
      "designer": {
        "xLocation": 391,
        "yLocation": 160,
        "next": "cf887de9e443-d47a25d4ea0d4902-328a"
      },
      "targetStepId": "af530ebc0fd1-d4589ef406bd6367-2744"
    },
    {
      "id": "ab38a0425e79-b8dc604135f5ef10-dd2f",
      "type": "prompt",
      "dataType": "[systemLocalizedStrings[\"/builtin/feedback.triage_prompt_yes\"], systemLocalizedStrings[\"/builtin/feedback.triage_prompt_no\"]]",
      "designer": {
        "xLocation": 660,
        "yLocation": 460,
        "listStyle": 3,
        "next": "665ed2aac701-c835c2db6d7c0a20-ebdd"
      },
      "text": "systemLocalizedStrings[\"/builtin/feedback.triage_prompt_question\"]",
      "variable": "show_feedback",
      "submitTitle": "Submit",
      "label": "Show feedback",
      "stringId": "stringId_1fd8f056fd6c7478",
      "choiceType": "choice"
    },
    {
      "id": "665ed2aac701-c835c2db6d7c0a20-ebdd",
      "type": "branch",
      "condition": "scenario.show_feedback.index == 0",
      "designer": {
        "xLocation": 660,
        "yLocation": 550
      },
      "targetStepId": "a5a7ee8cfa08-ea6c79fbed2be345-1fc3"
    },
    {
      "id": "a5a7ee8cfa08-ea6c79fbed2be345-1fc3",
      "type": "beginScenario",
      "designer": {
        "xLocation": 660,
        "yLocation": 640
      },
      "scenario": "/builtin/feedback"
    }
  ]
}
